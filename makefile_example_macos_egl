.POSIX:
NAME = example_macos_egl
CMD = ./example_macos_egl
OBJCOPY = objcopy
CC = o64-clang

LDFLAGS+= -Lres/angle/libs

LDLIBS+= -framework
LDLIBS+= AppKit
LDLIBS+= -lEGL
LDLIBS+= -lGLESv2

CFLAGS+= -std=c99
CFLAGS+= -pedantic
CFLAGS+= -Wall
CFLAGS+= -Wextra
CFLAGS+= -Werror=vla
CFLAGS+= -Werror
CFLAGS+= -Wno-address-of-packed-member
CFLAGS+= -Wno-unused-parameter
CFLAGS+= -Ires/globox/include
CFLAGS+= -Ires/willis/src
CFLAGS+= -Ires/cursoryx/src
CFLAGS+= -Ires/dpishit/src
CFLAGS+= -Ires/razorbeard/src
CFLAGS+= -Ires/razorbeard/src/default_widgets
CFLAGS+= -Iexample
CFLAGS+= -Ires/angle/include

CFLAGS+= -DGLOBOX_PLATFORM_MACOS
CFLAGS+= -DWILLIS_MACOS
CFLAGS+= -DWILLIS_DEBUG
CFLAGS+= -DCURSORYX_MACOS
CFLAGS+= -DDPISHIT_MACOS
CFLAGS+= -DGLOBOX_CONTEXT_EGL

OBJ+= res/willis/src/willis.o
OBJ+= res/willis/src/debug.o
OBJ+= res/willis/src/macos.o
OBJ+= res/cursoryx/src/macos.o
OBJ+= res/dpishit/src/macos.o
OBJ+= res/razorbeard/src/razorbeard.o
OBJ+= res/razorbeard/src/default_widgets/razorbeard_math.o
OBJ+= res/razorbeard/src/default_widgets/razorbeard_helpers.o
OBJ+= res/razorbeard/src/default_widgets/razorbeard_default_widgets.o
OBJ+= res/razorbeard/src/razorbeard.o
OBJ+= res/razorbeard/src/default_widgets/razorbeard_math.o
OBJ+= res/razorbeard/src/default_widgets/razorbeard_helpers.o
OBJ+= res/razorbeard/src/default_widgets/razorbeard_default_widgets.o
OBJ+= res/razorbeard/src/default_widgets/button/razorbeard_widget_button.o
OBJ+= res/razorbeard/src/default_widgets/checkbox/razorbeard_widget_checkbox.o
OBJ+= res/razorbeard/src/default_widgets/dropmenu/razorbeard_widget_dropmenu.o
OBJ+= res/razorbeard/src/default_widgets/frame/razorbeard_widget_frame.o
OBJ+= res/razorbeard/src/default_widgets/handles/razorbeard_widget_handles.o
OBJ+= res/razorbeard/src/default_widgets/image/razorbeard_widget_image.o
OBJ+= res/razorbeard/src/default_widgets/numberbox/razorbeard_widget_numberbox.o
OBJ+= res/razorbeard/src/default_widgets/pager/razorbeard_widget_pager.o
OBJ+= res/razorbeard/src/default_widgets/popup/razorbeard_widget_popup.o
OBJ+= res/razorbeard/src/default_widgets/progressbar/razorbeard_widget_progressbar.o
OBJ+= res/razorbeard/src/default_widgets/radiobutton/razorbeard_widget_radiobutton.o
OBJ+= res/razorbeard/src/default_widgets/scrollbar/razorbeard_widget_scrollbar.o
OBJ+= res/razorbeard/src/default_widgets/separator/razorbeard_widget_separator.o
OBJ+= res/razorbeard/src/default_widgets/slider/razorbeard_widget_slider.o
OBJ+= res/razorbeard/src/default_widgets/tabs/razorbeard_widget_tabs.o
OBJ+= res/razorbeard/src/default_widgets/text/razorbeard_widget_text.o
OBJ+= res/razorbeard/src/default_widgets/textarea/razorbeard_widget_textarea.o
OBJ+= res/razorbeard/src/default_widgets/textbox/razorbeard_widget_textbox.o
OBJ+= example/helpers.o
OBJ+= example/egl.o

OBJ_EXTRA+= res/globox/lib/globox/macos/globox_macos_egl.a

VALGRIND+= --show-error-list=yes
VALGRIND+= --show-leak-kinds=all
VALGRIND+= --track-origins=yes
VALGRIND+= --leak-check=full
VALGRIND+= --suppressions=../res/valgrind.supp

default: res/angle/libs bin/libEGL.dylib res/globox bin/$(NAME).app

bin/$(NAME).app: bin/$(NAME)
	mv bin/$(NAME) $@

bin/$(NAME): $(OBJ) $(OBJ_EXTRA)
	mkdir -p $(@D)
	$(CC) $(LDFLAGS) -o $@ $^ $(LDLIBS)

bin/libEGL.dylib: res/angle/libs
	cp res/angle/libs/*.dylib bin/

res/angle/libs:
	mkdir -p bin
	make/scripts/angle_dev_get.sh

res/globox:
	make/scripts/globox_get.sh

run: bin/$(NAME)
	cd bin && $(CMD)

willis.o: res/willis/src/willis.c res/willis/src/willis.h \
  res/willis/src/willis_events.h
debug.o: res/willis/src/debug.c
macos.o: res/willis/src/macos.c res/willis/src/willis.h \
  res/willis/src/willis_events.h res/willis/src/willis_macos.h \
  Carbon/Carbon.h CoreGraphics/CoreGraphics.h objc/message.h \
  objc/runtime.h
macos.o: res/cursoryx/src/macos.c res/cursoryx/src/cursoryx.h \
  res/cursoryx/src/cursoryx_macos.h objc/runtime.h \
  CoreGraphics/CoreGraphics.h objc/message.h
macos.o: res/dpishit/src/macos.c res/dpishit/src/dpishit.h \
  res/dpishit/src/dpishit_info.h res/dpishit/src/dpishit_macos.h \
  objc/runtime.h objc/message.h
razorbeard.o: res/razorbeard/src/razorbeard.c \
  res/razorbeard/src/razorbeard.h
razorbeard_math.o: res/razorbeard/src/default_widgets/razorbeard_math.c \
  res/razorbeard/src/default_widgets/razorbeard_math.h
razorbeard_helpers.o: \
  res/razorbeard/src/default_widgets/razorbeard_helpers.c \
  res/razorbeard/src/default_widgets/razorbeard_helpers.h \
  res/razorbeard/src/default_widgets/razorbeard_default_widgets.h \
  razorbeard.h res/razorbeard/src/default_widgets/razorbeard_math.h
razorbeard_default_widgets.o: \
  res/razorbeard/src/default_widgets/razorbeard_default_widgets.c \
  razorbeard.h res/razorbeard/src/default_widgets/razorbeard_helpers.h \
  res/razorbeard/src/default_widgets/razorbeard_default_widgets.h \
  res/razorbeard/src/default_widgets/razorbeard_math.h
razorbeard.o: res/razorbeard/src/razorbeard.c \
  res/razorbeard/src/razorbeard.h
razorbeard_math.o: res/razorbeard/src/default_widgets/razorbeard_math.c \
  res/razorbeard/src/default_widgets/razorbeard_math.h
razorbeard_helpers.o: \
  res/razorbeard/src/default_widgets/razorbeard_helpers.c \
  res/razorbeard/src/default_widgets/razorbeard_helpers.h \
  res/razorbeard/src/default_widgets/razorbeard_default_widgets.h \
  razorbeard.h res/razorbeard/src/default_widgets/razorbeard_math.h
razorbeard_default_widgets.o: \
  res/razorbeard/src/default_widgets/razorbeard_default_widgets.c \
  razorbeard.h res/razorbeard/src/default_widgets/razorbeard_helpers.h \
  res/razorbeard/src/default_widgets/razorbeard_default_widgets.h \
  res/razorbeard/src/default_widgets/razorbeard_math.h
razorbeard_widget_button.o: \
  res/razorbeard/src/default_widgets/button/razorbeard_widget_button.c \
  razorbeard.h razorbeard_helpers.h razorbeard_math.h \
  razorbeard_default_widgets.h \
  res/razorbeard/src/default_widgets/button/razorbeard_widget_button.h
razorbeard_widget_checkbox.o: \
  res/razorbeard/src/default_widgets/checkbox/razorbeard_widget_checkbox.c \
  razorbeard.h razorbeard_helpers.h razorbeard_math.h \
  razorbeard_default_widgets.h \
  res/razorbeard/src/default_widgets/checkbox/razorbeard_widget_checkbox.h
razorbeard_widget_dropmenu.o: \
  res/razorbeard/src/default_widgets/dropmenu/razorbeard_widget_dropmenu.c \
  razorbeard.h razorbeard_helpers.h razorbeard_math.h \
  razorbeard_default_widgets.h \
  res/razorbeard/src/default_widgets/dropmenu/razorbeard_widget_dropmenu.h
razorbeard_widget_frame.o: \
  res/razorbeard/src/default_widgets/frame/razorbeard_widget_frame.c \
  razorbeard.h razorbeard_helpers.h razorbeard_math.h \
  razorbeard_default_widgets.h \
  res/razorbeard/src/default_widgets/frame/razorbeard_widget_frame.h
razorbeard_widget_handles.o: \
  res/razorbeard/src/default_widgets/handles/razorbeard_widget_handles.c \
  razorbeard.h razorbeard_helpers.h razorbeard_math.h \
  razorbeard_default_widgets.h \
  res/razorbeard/src/default_widgets/handles/razorbeard_widget_handles.h
razorbeard_widget_image.o: \
  res/razorbeard/src/default_widgets/image/razorbeard_widget_image.c \
  razorbeard.h razorbeard_helpers.h razorbeard_math.h \
  razorbeard_default_widgets.h \
  res/razorbeard/src/default_widgets/image/razorbeard_widget_image.h
razorbeard_widget_numberbox.o: \
  res/razorbeard/src/default_widgets/numberbox/razorbeard_widget_numberbox.c \
  razorbeard.h razorbeard_helpers.h razorbeard_math.h \
  razorbeard_default_widgets.h \
  res/razorbeard/src/default_widgets/numberbox/razorbeard_widget_numberbox.h
razorbeard_widget_pager.o: \
  res/razorbeard/src/default_widgets/pager/razorbeard_widget_pager.c \
  razorbeard.h razorbeard_helpers.h razorbeard_math.h \
  razorbeard_default_widgets.h \
  res/razorbeard/src/default_widgets/pager/razorbeard_widget_pager.h
razorbeard_widget_popup.o: \
  res/razorbeard/src/default_widgets/popup/razorbeard_widget_popup.c \
  razorbeard.h razorbeard_helpers.h razorbeard_math.h \
  razorbeard_default_widgets.h \
  res/razorbeard/src/default_widgets/popup/razorbeard_widget_popup.h
razorbeard_widget_progressbar.o: \
  res/razorbeard/src/default_widgets/progressbar/razorbeard_widget_progressbar.c \
  razorbeard.h razorbeard_helpers.h razorbeard_math.h \
  razorbeard_default_widgets.h \
  res/razorbeard/src/default_widgets/progressbar/razorbeard_widget_progressbar.h
razorbeard_widget_radiobutton.o: \
  res/razorbeard/src/default_widgets/radiobutton/razorbeard_widget_radiobutton.c \
  razorbeard.h razorbeard_helpers.h razorbeard_math.h \
  razorbeard_default_widgets.h \
  res/razorbeard/src/default_widgets/radiobutton/razorbeard_widget_radiobutton.h
razorbeard_widget_scrollbar.o: \
  res/razorbeard/src/default_widgets/scrollbar/razorbeard_widget_scrollbar.c \
  razorbeard.h razorbeard_helpers.h razorbeard_math.h \
  razorbeard_default_widgets.h \
  res/razorbeard/src/default_widgets/scrollbar/razorbeard_widget_scrollbar.h
razorbeard_widget_separator.o: \
  res/razorbeard/src/default_widgets/separator/razorbeard_widget_separator.c \
  razorbeard.h razorbeard_helpers.h razorbeard_math.h \
  razorbeard_default_widgets.h \
  res/razorbeard/src/default_widgets/separator/razorbeard_widget_separator.h
razorbeard_widget_slider.o: \
  res/razorbeard/src/default_widgets/slider/razorbeard_widget_slider.c \
  razorbeard.h razorbeard_helpers.h razorbeard_math.h \
  razorbeard_default_widgets.h \
  res/razorbeard/src/default_widgets/slider/razorbeard_widget_slider.h
razorbeard_widget_tabs.o: \
  res/razorbeard/src/default_widgets/tabs/razorbeard_widget_tabs.c \
  razorbeard.h razorbeard_helpers.h razorbeard_math.h \
  razorbeard_default_widgets.h \
  res/razorbeard/src/default_widgets/tabs/razorbeard_widget_tabs.h
razorbeard_widget_text.o: \
  res/razorbeard/src/default_widgets/text/razorbeard_widget_text.c \
  razorbeard.h razorbeard_helpers.h razorbeard_math.h \
  razorbeard_default_widgets.h \
  res/razorbeard/src/default_widgets/text/razorbeard_widget_text.h
razorbeard_widget_textarea.o: \
  res/razorbeard/src/default_widgets/textarea/razorbeard_widget_textarea.c \
  razorbeard.h razorbeard_helpers.h razorbeard_math.h \
  razorbeard_default_widgets.h \
  res/razorbeard/src/default_widgets/textarea/razorbeard_widget_textarea.h
razorbeard_widget_textbox.o: \
  res/razorbeard/src/default_widgets/textbox/razorbeard_widget_textbox.c \
  razorbeard.h razorbeard_helpers.h razorbeard_math.h \
  razorbeard_default_widgets.h \
  res/razorbeard/src/default_widgets/textbox/razorbeard_widget_textbox.h
helpers.o: example/helpers.c example/helpers.h razorbeard.h \
  razorbeard_default_widgets.h button/razorbeard_widget_button.h \
  checkbox/razorbeard_widget_checkbox.h \
  dropmenu/razorbeard_widget_dropmenu.h frame/razorbeard_widget_frame.h \
  handles/razorbeard_widget_handles.h image/razorbeard_widget_image.h \
  numberbox/razorbeard_widget_numberbox.h \
  pager/razorbeard_widget_pager.h popup/razorbeard_widget_popup.h \
  progressbar/razorbeard_widget_progressbar.h \
  radiobutton/razorbeard_widget_radiobutton.h \
  scrollbar/razorbeard_widget_scrollbar.h \
  separator/razorbeard_widget_separator.h \
  slider/razorbeard_widget_slider.h tabs/razorbeard_widget_tabs.h \
  text/razorbeard_widget_text.h textarea/razorbeard_widget_textarea.h \
  textbox/razorbeard_widget_textbox.h
egl.o: example/egl.c globox.h globox_private_getters.h willis.h \
  cursoryx.h dpishit.h

clean:
	make/scripts/clean.sh
