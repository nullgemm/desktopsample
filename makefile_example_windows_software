.POSIX:
NAME = example_windows_software
CMD = ../make/scripts/dll_copy.sh globox_windows_software_mingw.dll && wine ./example_windows_software.exe
CC = x86_64-w64-mingw32-gcc

LDFLAGS+= -fno-stack-protector

LDLIBS+= -lgdi32
LDLIBS+= -ldwmapi
LDLIBS+= -lshcore
LDLIBS+= -mwindows

CFLAGS+= -std=c99
CFLAGS+= -pedantic
CFLAGS+= -Wall
CFLAGS+= -Wextra
CFLAGS+= -Werror=vla
CFLAGS+= -Werror
CFLAGS+= -Wno-address-of-packed-member
CFLAGS+= -Wno-unused-parameter
CFLAGS+= -Wno-implicit-fallthrough
CFLAGS+= -Wno-cast-function-type
CFLAGS+= -Wno-incompatible-pointer-types
CFLAGS+= -Ires/globox/include
CFLAGS+= -Ires/willis/src
CFLAGS+= -Ires/cursoryx/src
CFLAGS+= -Ires/dpishit/src
CFLAGS+= -Ires/razorbeard/src
CFLAGS+= -Ires/razorbeard/src/default_widgets
CFLAGS+= -Iexample

CFLAGS+= -DGLOBOX_PLATFORM_WINDOWS
CFLAGS+= -DWILLIS_WINDOWS
CFLAGS+= -DWILLIS_DEBUG
CFLAGS+= -DCURSORYX_WINDOWS
CFLAGS+= -DDPISHIT_WINDOWS
CFLAGS+= -DUNICODE
CFLAGS+= -D_UNICODE
CFLAGS+= -DWINVER=0x0A00
CFLAGS+= -D_WIN32_WINNT=0x0A00
CFLAGS+= -DCINTERFACE
CFLAGS+= -DCOBJMACROS
CFLAGS+= -DGLOBOX_CONTEXT_SOFTWARE

OBJ+= res/willis/src/willis.o
OBJ+= res/willis/src/debug.o
OBJ+= res/willis/src/windows.o
OBJ+= res/cursoryx/src/windows.o
OBJ+= res/dpishit/src/windows.o
OBJ+= res/razorbeard/src/razorbeard.o
OBJ+= res/razorbeard/src/default_widgets/razorbeard_math.o
OBJ+= res/razorbeard/src/default_widgets/razorbeard_helpers.o
OBJ+= res/razorbeard/src/default_widgets/razorbeard_default_widgets.o
OBJ+= example/helpers.o
OBJ+= example/software.o

OBJ_EXTRA+= res/globox/lib/globox/windows/globox_windows_software_mingw.a

default: res/globox bin/$(NAME)

bin/$(NAME): $(OBJ) $(OBJ_EXTRA)
	mkdir -p $(@D)
	$(CC) $(LDFLAGS) -o $@ $^ $(LDLIBS)

bin/eglproxy.dll: res/eglproxy
	mkdir -p $(@D)
	cp res/eglproxy/lib/mingw/eglproxy.dll $@

res/eglproxy:
	make/scripts/eglproxy_get.sh

res/egl_headers:
	make/scripts/egl_get.sh

res/globox:
	make/scripts/globox_get.sh

run: bin/$(NAME)
	cd bin && $(CMD)

willis.o: res/willis/src/willis.c res/willis/src/willis.h \
 res/willis/src/willis_events.h
debug.o: res/willis/src/debug.c
windows.o: res/willis/src/windows.c res/willis/src/willis.h \
 res/willis/src/willis_events.h
windows.o: res/cursoryx/src/windows.c res/cursoryx/src/cursoryx.h \
 res/cursoryx/src/cursoryx_windows.h
windows.o: res/dpishit/src/windows.c res/dpishit/src/dpishit.h \
 res/dpishit/src/dpishit_info.h
razorbeard.o: res/razorbeard/src/razorbeard.c \
 res/razorbeard/src/razorbeard.h
razorbeard_math.o: res/razorbeard/src/default_widgets/razorbeard_math.c \
 res/razorbeard/src/default_widgets/razorbeard_math.h
razorbeard_helpers.o: \
 res/razorbeard/src/default_widgets/razorbeard_helpers.c \
 res/razorbeard/src/default_widgets/razorbeard_helpers.h razorbeard.h \
 res/razorbeard/src/default_widgets/razorbeard_math.h
razorbeard_default_widgets.o: \
 res/razorbeard/src/default_widgets/razorbeard_default_widgets.c \
 razorbeard.h res/razorbeard/src/default_widgets/razorbeard_helpers.h \
 res/razorbeard/src/default_widgets/razorbeard_math.h \
 res/razorbeard/src/default_widgets/razorbeard_default_widgets.h \
 razorbeard_events.h
helpers.o: example/helpers.c example/helpers.h razorbeard.h \
 razorbeard_default_widgets.h
software.o: example/software.c globox.h globox_private_getters.h willis.h \
 cursoryx.h dpishit.h example/helpers.h razorbeard.h \
 razorbeard_default_widgets.h

clean:
	make/scripts/clean.sh
